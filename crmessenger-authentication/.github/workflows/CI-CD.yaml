name: CI/CD
on:
  push:
    branches:
      - main
jobs:
  build:
    name: Build
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Connect to server and execute commands
        env:
            SERVER: 77.232.138.131
            USER: root
            PASSWORD: ${{ secrets.SSH_PASSWORD }}

        run: |
          apt install sshpass -y
          sshpass -p "$PASSWORD" ssh -o StrictHostKeyChecking=no $USER@$SERVER << EOF
          cd widget-amocrm-stit
          git pull
          cd ../widget-system
          docker-compose up -d --no-deps --build widget-amocrm-stit
          EOF
